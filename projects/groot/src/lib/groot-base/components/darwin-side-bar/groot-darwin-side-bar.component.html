<ng-container *ngIf="menu && menu.length">
  <div class="menu-tabs">
    <ng-container *ngFor="let tab of menu">

      <ng-container *ngIf="tab">
        <div class="menu-tab"
             [grootNeedsCapability]="tab.requiredCapabilities"
             [ngClass]="tab.additionalClasses"
             [class.selected]="tab == currentFirstLevel"
             [class.open]="tab.open"
             (click)="clickOnFirstLevel(tab)">
          <i *ngIf="tab.icon" class="{{tab.icon}}"></i>
          <img *ngIf="tab.image" [src]="tab.image" alt="Menu image">
          <span class="title">{{tab.label | translate}}</span>
        </div>
      </ng-container>
      <ng-container *ngIf="!tab">
        <div class="menu-tab-empty"></div>
      </ng-container>

    </ng-container>
  </div>

  <div class="menu-items"
       [class.open]="currentFirstLevel && currentFirstLevel.open">
    <ng-container *ngIf="currentFirstLevel && currentFirstLevel.open">
      <div *ngFor="let secondLevel of currentFirstLevel.children"
           [grootNeedsCapability]="secondLevel.requiredCapabilities"
           class="menu-accordion">
        <div class="accordion-title"
             [ngClass]="secondLevel.additionalClasses"
             [class.clickable]="!secondLevel.forcedOpen"
             (click)="clickOnSecondLevel(secondLevel)">
          <span class="title">{{secondLevel.label | translate}}</span>

          <ng-container *ngIf="!secondLevel.forcedOpen">
            <i class="fa fa-angle-down" *ngIf="!secondLevel.open"></i>
            <i class="fa fa-angle-up" *ngIf="secondLevel.open"></i>
          </ng-container>
        </div>

        <div class="accordion-items"
             *ngIf="secondLevel.open"
             [@dropDown]>
          <ng-container *ngFor="let thirdLevel of secondLevel.children">
            <ng-container *ngIf="forceReloadStates || thirdLevel.forceReloadStates">
              <!-- If we cannot create a hyperlink -->
              <div
                [grootNeedsCapability]="thirdLevel.requiredCapabilities"
                class="menu-entry"
                [ngClass]="thirdLevel.additionalClasses"
                [class.selected]="thirdLevel.selected"
                [class.disabled]="thirdLevel.disabled"
                (click)="clickOnThirdLevel(thirdLevel)">
                {{thirdLevel.label | translate}}
              </div>
            </ng-container>
            <ng-container *ngIf="!(forceReloadStates || thirdLevel.forceReloadStates)">
              <!-- If possible, create an hyperlink using the router link directive -->
              <a
                [grootNeedsCapability]="thirdLevel.requiredCapabilities"
                class="menu-entry"
                [ngClass]="thirdLevel.additionalClasses"
                [class.selected]="thirdLevel.selected"
                [class.disabled]="thirdLevel.disabled"
                [routerLink]="thirdLevel.disabled ? null : thirdLevel.routingTarget"
                [queryParams]="thirdLevel.routingNavigationExtras?.queryParams"
                [fragment]="thirdLevel.routingNavigationExtras?.fragment"
                [queryParamsHandling]="thirdLevel.routingNavigationExtras?.queryParamsHandling"
                [preserveFragment]="thirdLevel.routingNavigationExtras?.preserveFragment"
                [relativeTo]="thirdLevel.routingNavigationExtras?.relativeTo"
                [skipLocationChange]="thirdLevel.routingNavigationExtras?.skipLocationChange"
                [replaceUrl]="thirdLevel.routingNavigationExtras?.replaceUrl"
                [state]="thirdLevel.routingNavigationExtras?.state"
                (click)="clickOnThirdLevel(thirdLevel)">
                {{thirdLevel.label | translate}}
              </a>
            </ng-container>
          </ng-container>
        </div>
      </div>
    </ng-container>
  </div>
</ng-container>
